mode: bf

# Exchanges to include (leaner prod set; can expand as needed)
ex: [binance, bitget, mexc]

quote: USDT
inv: 0.0  # Always use wallet; do not assume extra investment

bf:
  # Anchors restringidas a stables líquidas para evitar exposure a fiat con gaps grandes.
  # allowed_quotes: [USDT, USDC]
  allowed_quotes: [USDT,USDC, TUSD, USDP, EURS, PAXG]

  fee: 0.10                  # modela taker≈0.1% por hop
  rank_by_qvol: false        # desactivar ranking por liquidez para no filtrar nada
  currencies_limit: 500      # ampliar cobertura para diagnóstico
  min_net: -10000            # permitir negativos extremos
  min_net_per_hop: -10000    # permitir negativos por hop
  top: 200                   # ampliar listado para diagnóstico
  require_quote: false       # permitir ciclos no anclados en quote
  require_topofbook: true   # no exigir top-of-book para no filtrar
  min_quote_vol: 0           # sin filtro por liquidez
  min_hops: 0                # sin mínimo de hops
  max_hops: 0                # sin máximo de hops
  threads: 0                 # use default pool / per-exchange parallelism
  require_dual_quote: false
  persist_top_csv: true
  revalidate_depth: false    # no revalidar profundidad para no descartar
  use_ws: true               # WS para menor latencia si disponible
  depth_levels: 20           # niveles más profundos en revalidación
  latency_penalty_bps: 0     # sin penalización por latencia
  reset_history: true
  iter_timeout_sec: 0
  # Forzar listado de triángulos (incluye nets negativos) cuando BF no encuentra ciclos
  debug_list_triangles: true
  # Dev: devolver TODOS los ciclos (aunque sean filtrados) para diagnóstico ultra-abierto
  log_all_cycles: true

max: 280                    # Alinear con reducción de currencies_limit para calidad
timeout: 20000
sleep: 0
repeat: 100
repeat_sleep: 0

# Note: use_balance/balance_kind removed; tool now always reads wallet balances when available
balance_provider: ccxt
ex_auth_only: false
simulate_compound: true
# Para acelerar y evitar 10-12s de prefetch de wallet por iteración, desactivar:
simulate_from_wallet: false
simulate_prefer: auto
simulate_select: best
simulate_auto_switch: true
simulate_fallback_to_inv: false

no_console_clear: true

ui:
  progress_bar: true
  progress_len: 20
  spinner_frames: "|/-\\"
  draw_tables_first: true
  show_simulation_header_always: true

tri:
  fee: 0.10
  currencies_limit: 120
  min_net: -10000           # TRI stricter: require larger buffer for execution
  top: 40
  require_topofbook: true
  min_quote_vol: 0
  time_budget_sec: 1.0

# Engine techniques orchestration (process-pool based)
techniques:
  enabled: [bellman_ford, stat_tri]
  max_workers: 2
  enable_rerank_onnx: false
  fallback_timeout: 8.0
  telemetry_file: ./artifacts/arbitraje/techniques_telemetry.log
  inline: [bellman_ford, stat_tri]
  iteration_watchdog_sec: 10.0
  # Pruning agresivo para acelerar BF
  pruning_degree_threshold: 0     # desactivar pruning por grado
  pruning_qvol_frac: 0.0          # desactivar pruning por qvol
  pruning_volatility_window: 0    # desactivar pruning por volatilidad

# Per-exchange overrides (optional) — these can tune aggressiveness per-exchange.
exchange_overrides: {}

# Manual blacklist (prod) – if needed, configure via artifacts/config blacklist file used by load_swaps_blacklist()
# (Inline YAML blacklist removed due to unsupported schema)

# Watchdogs duros para evitar bloqueos por exchange/iteración
per_exchange_watchdog_sec: 60
iteration_watchdog_sec: 300
# NOTAS de endurecimiento:
# - require_topofbook + min_quote_vol + revalidate_depth + latency_penalty reducen falsos positivos.
# - min_net elevado (0.6%) + min_net_per_hop evita que micro spreads sumen aparente net positivo frágil.
# - Blacklist temporal de TRY hops específicos tras pérdida real; revisar y retirar si se estabilizan.
